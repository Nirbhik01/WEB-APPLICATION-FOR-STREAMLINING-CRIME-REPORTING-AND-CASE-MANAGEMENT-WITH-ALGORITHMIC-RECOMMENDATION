{%extends "BaseTemplate.html"%}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    {%load static tailwind_tags%}
    {%tailwind_css%}
</head>

<body>
    {%block main_content%}
    <div class=" md:mx-10 mx-5 md:mt-10 ">
        <div class="md:flex md:flex-row-reverse justify-between gap-10 block">
            <form action="" method="post" id="filter-form"
                class="text-black h-auto self-start bg-light-gray md:w-1/3 mt-10 md:mt-0 w-full rounded-lg p-5 transform duration-500">
                <h3 class="text-xl font-semibold">Filters</h3>
                <div class="md:grid-cols-1 mt-5 sm:gri-cols-1 grid-cols-3 gap-5">
                    <div class=" gap-5 ">
                        <div class="">
                            <label for="from" class="">From : </label><br>
                            <input type="date" name="startDate" class=" w-full rounded-lg border-0 mt-2" id="">
                        </div>
                        <div class=" mt-5">
                            <label for="to" class="">To : </label><br>
                            <input type="date" name="endDate" class="    w-full rounded-lg border-0 mt-2" id="">
                        </div>
                    </div>
                    <div class="mt-5 ">
                        <label for="to" class="">Type of Crime : </label><br>
                        <div class="flex gap-5 sm:flex-col sm:gap-0 mt-2">
                            <select name="crime_type" type="text" required class="rounded-lg h-10 border-0 "
                                placeholder="Enter name">
                                <option value="" disabled selected value>choose an option</option>
                                <option value="ANTISOCIAL">Antisocial Behaviour</option>
                                <option value="BURGLARY">Burglary</option>
                                <option value="CRIMINAL_DAMAGE">Criminal Damage</option>
                                <option value="CYBERCRIME">CyberCrime</option>
                                <option value="FRAUD">Fraud</option>
                                <option value="HATE_CRIME">Hate Crime</option>
                                <option value="ROBBERY">Robbery</option>
                                <option value="RURAL_CRIME">Rural Crime</option>
                                <option value="SPIKING">Spiking</option>
                                <option value="STACKING">Stacking</option>
                            </select>
                            <button type="submit" id="filter-button"
                                class="  px-7 py-1 sm:mt-5 h-10 bg-cool-gray text-white rounded-lg font-medium hover:underline hover:scale-[1.02] hover:shadow-md duration-100">Submit</button>

                        </div>
                    </div>
                </div>

            </form>
            <div id="display-cases" class="md:w-2/3 w-full md:mt-0 mt-10  ">

            </div>
        </div>
    </div>
    <script>
        const search_input = document.getElementById('search-input').value;
        const filter_form = document.getElementById('filter-form');
        const filter_button = document.getElementById('filter-button');
       
        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('q');
        
            let fetchUrl = '/case/getcases/';
            if (searchQuery) {
                fetchUrl = `/case/searchcases/?q=${encodeURIComponent(searchQuery)}`;
            }
            fetch(fetchUrl)
                .then(response => response.json())
                .then(data => {
                    if(!(data.length === 0)) {
                        const display_cases_block = document.getElementById('display-cases');
                        display_cases_block.innerHTML = '';
            
                        data.forEach(caseData => {
                        let url = `/reviewfir/${caseData.case_id}/`;
                        let display_cases_block_child = document.createElement('a');
                        display_cases_block_child.className = "flex w-full shadow-lg rounded-lg mb-10 border border-gray duration-500 hover:-translate-y-1";
                        display_cases_block_child.href = url;
        
                        display_cases_block_child.innerHTML = `
                            <img class="aspect-1 border-r bg-light-gray border-gray object-contain md:w-40 sm:w-32 w-[6.5rem] rounded-l-lg"
                                src="/media/${caseData.reporter__user_profile_picture}" alt="">
                            <div class="w-full p-5">
                                <h1 class="text-xl font-semibold">${caseData.case_title}</h1>
                                <p class="text-base mt-2 leading-relaxed">${caseData.crime_description}</p>
                                <p class="text-sm mt-2 leading-relaxed">Reporter: ${caseData.reporter__user_name}</p>
                                <p class="float-end text-sm mt-2 leading-relaxed">Uploaded on: ${caseData.upload_date.split("T")[0]}</p>
                            </div>
                        `;
                        display_cases_block.appendChild(display_cases_block_child);
                    });
                    }
                    else{
                        const display_cases_block = document.getElementById('display-cases');
                        display_cases_block.innerHTML = `
                            <div class="flex h-full">
                                <h1 class="text-2xl font-semibold">No Cases Found for "${searchQuery}"</h1>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    console.error('Error fetching cases:', error);
                });
        });
        
    </script>
    {%endblock%}
</body>

</html>